/*
Deployment script for Timesheet

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "Timesheet"
:setvar DefaultFilePrefix "Timesheet"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL13.MSSQLSERVER\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL13.MSSQLSERVER\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
/*
The type for column ClientId in table [dbo].[Client] is currently  INT IDENTITY (1, 1) NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column CompanyId in table [dbo].[Client] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column CreatedBy in table [dbo].[Client] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.
*/

IF EXISTS (select top 1 1 from [dbo].[Client])
    RAISERROR (N'Rows were detected. The schema update is terminating because data loss might occur.', 16, 127) WITH NOWAIT

GO
/*
The type for column CompanyId in table [dbo].[Company] is currently  INT IDENTITY (1, 1) NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column CreatedBy in table [dbo].[Company] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.
*/

IF EXISTS (select top 1 1 from [dbo].[Company])
    RAISERROR (N'Rows were detected. The schema update is terminating because data loss might occur.', 16, 127) WITH NOWAIT

GO
/*
The type for column CompanyId in table [dbo].[Invoice] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column CreatedBy in table [dbo].[Invoice] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column InvoiceId in table [dbo].[Invoice] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column IssuedTo in table [dbo].[Invoice] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column PurchaseOrderId in table [dbo].[Invoice] is currently  INT NULL but is being changed to  UNIQUEIDENTIFIER NULL. There is no implicit or explicit conversion.
*/

IF EXISTS (select top 1 1 from [dbo].[Invoice])
    RAISERROR (N'Rows were detected. The schema update is terminating because data loss might occur.', 16, 127) WITH NOWAIT

GO
/*
The type for column CreatedBy in table [dbo].[InvoiceLineItem] is currently  INT NULL but is being changed to  UNIQUEIDENTIFIER NULL. There is no implicit or explicit conversion.

The type for column InvoiceId in table [dbo].[InvoiceLineItem] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column InvoiceLineItemId in table [dbo].[InvoiceLineItem] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column TimesheetId in table [dbo].[InvoiceLineItem] is currently  INT NULL but is being changed to  UNIQUEIDENTIFIER NULL. There is no implicit or explicit conversion.
*/

IF EXISTS (select top 1 1 from [dbo].[InvoiceLineItem])
    RAISERROR (N'Rows were detected. The schema update is terminating because data loss might occur.', 16, 127) WITH NOWAIT

GO
/*
The type for column CreatedBy in table [dbo].[Person] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column PersonId in table [dbo].[Person] is currently  INT IDENTITY (1, 1) NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.
*/

IF EXISTS (select top 1 1 from [dbo].[Person])
    RAISERROR (N'Rows were detected. The schema update is terminating because data loss might occur.', 16, 127) WITH NOWAIT

GO
/*
The type for column ClientId in table [dbo].[Project] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column CreatedBy in table [dbo].[Project] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column ProjectId in table [dbo].[Project] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.
*/

IF EXISTS (select top 1 1 from [dbo].[Project])
    RAISERROR (N'Rows were detected. The schema update is terminating because data loss might occur.', 16, 127) WITH NOWAIT

GO
/*
The type for column CreatedBy in table [dbo].[PurchaseOrder] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column IssuedBy in table [dbo].[PurchaseOrder] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column PurchaseOrderId in table [dbo].[PurchaseOrder] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.
*/

IF EXISTS (select top 1 1 from [dbo].[PurchaseOrder])
    RAISERROR (N'Rows were detected. The schema update is terminating because data loss might occur.', 16, 127) WITH NOWAIT

GO
/*
The type for column CreatedBy in table [dbo].[Resource] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column ProjectId in table [dbo].[Resource] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column ResourceId in table [dbo].[Resource] is currently  INT IDENTITY (1, 1) NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column StaffId in table [dbo].[Resource] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.
*/

IF EXISTS (select top 1 1 from [dbo].[Resource])
    RAISERROR (N'Rows were detected. The schema update is terminating because data loss might occur.', 16, 127) WITH NOWAIT

GO
/*
The type for column CompanyId in table [dbo].[Staff] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column CreatedBy in table [dbo].[Staff] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column PersonId in table [dbo].[Staff] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column StaffId in table [dbo].[Staff] is currently  INT IDENTITY (1, 1) NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.
*/

IF EXISTS (select top 1 1 from [dbo].[Staff])
    RAISERROR (N'Rows were detected. The schema update is terminating because data loss might occur.', 16, 127) WITH NOWAIT

GO
/*
The type for column CompanyId in table [dbo].[TimeCode] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column CreatedBy in table [dbo].[TimeCode] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column TimeCodeId in table [dbo].[TimeCode] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.
*/

IF EXISTS (select top 1 1 from [dbo].[TimeCode])
    RAISERROR (N'Rows were detected. The schema update is terminating because data loss might occur.', 16, 127) WITH NOWAIT

GO
/*
The type for column CreatedBy in table [dbo].[Timesheet] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column ProjectId in table [dbo].[Timesheet] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column StaffId in table [dbo].[Timesheet] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column TimeCodeId in table [dbo].[Timesheet] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column TimesheetId in table [dbo].[Timesheet] is currently  INT IDENTITY (1, 1) NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.
*/

IF EXISTS (select top 1 1 from [dbo].[Timesheet])
    RAISERROR (N'Rows were detected. The schema update is terminating because data loss might occur.', 16, 127) WITH NOWAIT

GO
/*
The type for column CreatedBy in table [dbo].[User] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column PersonId in table [dbo].[User] is currently  INT NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.

The type for column UserId in table [dbo].[User] is currently  INT IDENTITY (1, 1) NOT NULL but is being changed to  UNIQUEIDENTIFIER NOT NULL. There is no implicit or explicit conversion.
*/

IF EXISTS (select top 1 1 from [dbo].[User])
    RAISERROR (N'Rows were detected. The schema update is terminating because data loss might occur.', 16, 127) WITH NOWAIT

GO
PRINT N'Starting rebuilding table [dbo].[Client]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Client] (
    [ClientId]    UNIQUEIDENTIFIER DEFAULT newid() NOT NULL,
    [CompanyId]   UNIQUEIDENTIFIER NOT NULL,
    [Name]        NVARCHAR (50)    NOT NULL,
    [DateCreated] DATETIME         NOT NULL,
    [CreatedBy]   UNIQUEIDENTIFIER NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Client1] PRIMARY KEY CLUSTERED ([ClientId] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Client])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Client] ([ClientId], [CompanyId], [Name], [DateCreated], [CreatedBy])
        SELECT   [ClientId],
                 [CompanyId],
                 [Name],
                 [DateCreated],
                 [CreatedBy]
        FROM     [dbo].[Client]
        ORDER BY [ClientId] ASC;
    END

DROP TABLE [dbo].[Client];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Client]', N'Client';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Client1]', N'PK_Client', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[Company]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Company] (
    [CompanyId]   UNIQUEIDENTIFIER DEFAULT newid() NOT NULL,
    [Name]        NVARCHAR (50)    NOT NULL,
    [DateCreated] DATETIME         NOT NULL,
    [CreatedBy]   UNIQUEIDENTIFIER NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Company1] PRIMARY KEY CLUSTERED ([CompanyId] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Company])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Company] ([CompanyId], [Name], [DateCreated], [CreatedBy])
        SELECT   [CompanyId],
                 [Name],
                 [DateCreated],
                 [CreatedBy]
        FROM     [dbo].[Company]
        ORDER BY [CompanyId] ASC;
    END

DROP TABLE [dbo].[Company];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Company]', N'Company';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Company1]', N'PK_Company', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[Invoice]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Invoice] (
    [InvoiceId]       UNIQUEIDENTIFIER DEFAULT newid() NOT NULL,
    [CompanyId]       UNIQUEIDENTIFIER NOT NULL,
    [IssuedTo]        UNIQUEIDENTIFIER NOT NULL,
    [PurchaseOrderId] UNIQUEIDENTIFIER NULL,
    [DateIssued]      DATETIME         NOT NULL,
    [DatePaid]        DATETIME         NULL,
    [Amount]          DECIMAL (18, 2)  NOT NULL,
    [GST]             DECIMAL (18, 2)  NOT NULL,
    [TotalAmount]     DECIMAL (18, 2)  NOT NULL,
    [DateCreated]     DATETIME         NOT NULL,
    [CreatedBy]       UNIQUEIDENTIFIER NOT NULL,
    PRIMARY KEY CLUSTERED ([InvoiceId] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Invoice])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Invoice] ([InvoiceId], [CompanyId], [IssuedTo], [PurchaseOrderId], [DateIssued], [DatePaid], [Amount], [GST], [TotalAmount], [DateCreated], [CreatedBy])
        SELECT   [InvoiceId],
                 [CompanyId],
                 [IssuedTo],
                 [PurchaseOrderId],
                 [DateIssued],
                 [DatePaid],
                 [Amount],
                 [GST],
                 [TotalAmount],
                 [DateCreated],
                 [CreatedBy]
        FROM     [dbo].[Invoice]
        ORDER BY [InvoiceId] ASC;
    END

DROP TABLE [dbo].[Invoice];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Invoice]', N'Invoice';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[InvoiceLineItem]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_InvoiceLineItem] (
    [InvoiceLineItemId] UNIQUEIDENTIFIER DEFAULT newid() NOT NULL,
    [InvoiceId]         UNIQUEIDENTIFIER NOT NULL,
    [TimesheetId]       UNIQUEIDENTIFIER NULL,
    [Description]       NVARCHAR (100)   NULL,
    [Amount]            DECIMAL (18, 2)  NOT NULL,
    [GST]               DECIMAL (18, 2)  NOT NULL,
    [TotalAmount]       DECIMAL (18, 2)  NOT NULL,
    [DateCreated]       DATETIME         NULL,
    [CreatedBy]         UNIQUEIDENTIFIER NULL,
    PRIMARY KEY CLUSTERED ([InvoiceLineItemId] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[InvoiceLineItem])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_InvoiceLineItem] ([InvoiceLineItemId], [InvoiceId], [TimesheetId], [Description], [Amount], [GST], [TotalAmount], [DateCreated], [CreatedBy])
        SELECT   [InvoiceLineItemId],
                 [InvoiceId],
                 [TimesheetId],
                 [Description],
                 [Amount],
                 [GST],
                 [TotalAmount],
                 [DateCreated],
                 [CreatedBy]
        FROM     [dbo].[InvoiceLineItem]
        ORDER BY [InvoiceLineItemId] ASC;
    END

DROP TABLE [dbo].[InvoiceLineItem];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_InvoiceLineItem]', N'InvoiceLineItem';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[Person]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Person] (
    [PersonId]      UNIQUEIDENTIFIER DEFAULT newid() NOT NULL,
    [GivenNames]    NVARCHAR (50)    NOT NULL,
    [PreferredName] NVARCHAR (50)    NOT NULL,
    [Surname]       NVARCHAR (50)    NOT NULL,
    [Email]         NVARCHAR (50)    NOT NULL,
    [DateCreated]   DATETIME         NOT NULL,
    [CreatedBy]     UNIQUEIDENTIFIER NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Person1] PRIMARY KEY CLUSTERED ([PersonId] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Person])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Person] ([PersonId], [GivenNames], [PreferredName], [Surname], [Email], [DateCreated], [CreatedBy])
        SELECT   [PersonId],
                 [GivenNames],
                 [PreferredName],
                 [Surname],
                 [Email],
                 [DateCreated],
                 [CreatedBy]
        FROM     [dbo].[Person]
        ORDER BY [PersonId] ASC;
    END

DROP TABLE [dbo].[Person];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Person]', N'Person';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Person1]', N'PK_Person', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[Project]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Project] (
    [ProjectId]   UNIQUEIDENTIFIER DEFAULT newid() NOT NULL,
    [ClientId]    UNIQUEIDENTIFIER NOT NULL,
    [Name]        NVARCHAR (50)    NOT NULL,
    [DateCreated] DATETIME         NOT NULL,
    [CreatedBy]   UNIQUEIDENTIFIER NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Project1] PRIMARY KEY CLUSTERED ([ProjectId] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Project])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Project] ([ProjectId], [ClientId], [Name], [DateCreated], [CreatedBy])
        SELECT   [ProjectId],
                 [ClientId],
                 [Name],
                 [DateCreated],
                 [CreatedBy]
        FROM     [dbo].[Project]
        ORDER BY [ProjectId] ASC;
    END

DROP TABLE [dbo].[Project];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Project]', N'Project';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Project1]', N'PK_Project', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[PurchaseOrder]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_PurchaseOrder] (
    [PurchaseOrderId] UNIQUEIDENTIFIER DEFAULT newid() NOT NULL,
    [IssuedBy]        UNIQUEIDENTIFIER NOT NULL,
    [PurchaseOrderNo] NVARCHAR (50)    NULL,
    [Amount]          DECIMAL (18, 2)  NOT NULL,
    [DateCreated]     DATETIME         NOT NULL,
    [CreatedBy]       UNIQUEIDENTIFIER NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_PurchaseOrder1] PRIMARY KEY CLUSTERED ([PurchaseOrderId] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[PurchaseOrder])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_PurchaseOrder] ([PurchaseOrderId], [IssuedBy], [PurchaseOrderNo], [Amount], [DateCreated], [CreatedBy])
        SELECT   [PurchaseOrderId],
                 [IssuedBy],
                 [PurchaseOrderNo],
                 [Amount],
                 [DateCreated],
                 [CreatedBy]
        FROM     [dbo].[PurchaseOrder]
        ORDER BY [PurchaseOrderId] ASC;
    END

DROP TABLE [dbo].[PurchaseOrder];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_PurchaseOrder]', N'PurchaseOrder';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_PurchaseOrder1]', N'PK_PurchaseOrder', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[Resource]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Resource] (
    [ResourceId]  UNIQUEIDENTIFIER DEFAULT newid() NOT NULL,
    [ProjectId]   UNIQUEIDENTIFIER NOT NULL,
    [StaffId]     UNIQUEIDENTIFIER NOT NULL,
    [Description] NVARCHAR (100)   NULL,
    [DateCreated] DATETIME         NOT NULL,
    [CreatedBy]   UNIQUEIDENTIFIER NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Resource1] PRIMARY KEY CLUSTERED ([ResourceId] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Resource])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Resource] ([ResourceId], [ProjectId], [StaffId], [Description], [DateCreated], [CreatedBy])
        SELECT   [ResourceId],
                 [ProjectId],
                 [StaffId],
                 [Description],
                 [DateCreated],
                 [CreatedBy]
        FROM     [dbo].[Resource]
        ORDER BY [ResourceId] ASC;
    END

DROP TABLE [dbo].[Resource];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Resource]', N'Resource';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Resource1]', N'PK_Resource', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[Staff]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Staff] (
    [StaffId]       UNIQUEIDENTIFIER DEFAULT newid() NOT NULL,
    [CompanyId]     UNIQUEIDENTIFIER NOT NULL,
    [PersonId]      UNIQUEIDENTIFIER NOT NULL,
    [PositionTitle] NVARCHAR (50)    NULL,
    [DateCreated]   DATETIME         NOT NULL,
    [CreatedBy]     UNIQUEIDENTIFIER NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Staff1] PRIMARY KEY CLUSTERED ([StaffId] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Staff])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Staff] ([StaffId], [CompanyId], [PersonId], [PositionTitle], [DateCreated], [CreatedBy])
        SELECT   [StaffId],
                 [CompanyId],
                 [PersonId],
                 [PositionTitle],
                 [DateCreated],
                 [CreatedBy]
        FROM     [dbo].[Staff]
        ORDER BY [StaffId] ASC;
    END

DROP TABLE [dbo].[Staff];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Staff]', N'Staff';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Staff1]', N'PK_Staff', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[TimeCode]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_TimeCode] (
    [TimeCodeId]  UNIQUEIDENTIFIER DEFAULT newid() NOT NULL,
    [CompanyId]   UNIQUEIDENTIFIER NOT NULL,
    [Name]        NVARCHAR (50)    NOT NULL,
    [Description] NVARCHAR (100)   NULL,
    [DateCreated] DATETIME         NOT NULL,
    [CreatedBy]   UNIQUEIDENTIFIER NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_TimeCode1] PRIMARY KEY CLUSTERED ([TimeCodeId] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[TimeCode])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_TimeCode] ([TimeCodeId], [CompanyId], [Name], [Description], [DateCreated], [CreatedBy])
        SELECT   [TimeCodeId],
                 [CompanyId],
                 [Name],
                 [Description],
                 [DateCreated],
                 [CreatedBy]
        FROM     [dbo].[TimeCode]
        ORDER BY [TimeCodeId] ASC;
    END

DROP TABLE [dbo].[TimeCode];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_TimeCode]', N'TimeCode';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_TimeCode1]', N'PK_TimeCode', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[Timesheet]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Timesheet] (
    [TimesheetId]   UNIQUEIDENTIFIER DEFAULT newid() NOT NULL,
    [ProjectId]     UNIQUEIDENTIFIER NOT NULL,
    [StaffId]       UNIQUEIDENTIFIER NOT NULL,
    [TimeCodeId]    UNIQUEIDENTIFIER NOT NULL,
    [StartDateTime] DATETIME         NOT NULL,
    [EndDateTime]   DATETIME         NULL,
    [Description]   NVARCHAR (400)   NOT NULL,
    [DateCreated]   DATETIME         NOT NULL,
    [CreatedBy]     UNIQUEIDENTIFIER NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_Timesheet1] PRIMARY KEY CLUSTERED ([TimesheetId] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Timesheet])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Timesheet] ([TimesheetId], [ProjectId], [StaffId], [TimeCodeId], [StartDateTime], [EndDateTime], [Description], [DateCreated], [CreatedBy])
        SELECT   [TimesheetId],
                 [ProjectId],
                 [StaffId],
                 [TimeCodeId],
                 [StartDateTime],
                 [EndDateTime],
                 [Description],
                 [DateCreated],
                 [CreatedBy]
        FROM     [dbo].[Timesheet]
        ORDER BY [TimesheetId] ASC;
    END

DROP TABLE [dbo].[Timesheet];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Timesheet]', N'Timesheet';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_Timesheet1]', N'PK_Timesheet', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[User]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_User] (
    [UserId]      UNIQUEIDENTIFIER DEFAULT newid() NOT NULL,
    [PersonId]    UNIQUEIDENTIFIER NOT NULL,
    [LoginName]   NVARCHAR (50)    NOT NULL,
    [Password]    NVARCHAR (50)    NOT NULL,
    [DateCreated] DATETIME         NOT NULL,
    [CreatedBy]   UNIQUEIDENTIFIER NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_User1] PRIMARY KEY CLUSTERED ([UserId] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[User])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_User] ([UserId], [PersonId], [LoginName], [Password], [DateCreated], [CreatedBy])
        SELECT   [UserId],
                 [PersonId],
                 [LoginName],
                 [Password],
                 [DateCreated],
                 [CreatedBy]
        FROM     [dbo].[User]
        ORDER BY [UserId] ASC;
    END

DROP TABLE [dbo].[User];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_User]', N'User';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_User1]', N'PK_User', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Update complete.';


GO
